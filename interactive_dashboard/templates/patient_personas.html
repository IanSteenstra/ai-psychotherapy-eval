<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Persona Library</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="/static/styles.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container d-flex align-items-center justify-content-between">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}"><i class="fas fa-brain me-2"></i> An Evaluation Framework for Assessing Quality of Care & Risk in AI Psychotherapy</a>
            <div class="d-flex gap-2 flex-wrap justify-content-end">
                <a class="btn btn-outline-light btn-sm" href="{{ url_for('interventions') }}">Interventions</a>
                <a class="btn btn-outline-light btn-sm" href="{{ url_for('pairings') }}">Pairings</a>
                <a class="btn btn-outline-light btn-sm" href="{{ url_for('therapist_prompts') }}">Therapist Prompts</a>
                <a class="btn btn-outline-light btn-sm" href="{{ url_for('dashboard') }}"><i class="fas fa-home me-1"></i>Back to Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-4">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h1 class="card-title h3 mb-3">Patient Persona Library</h1>
                        <p class="card-text text-muted mb-0">Select a patient persona to review its summary and key characteristics.</p>
                    </div>
                </div>
            </div>
        </div>

        {% if personas %}
            <div class="row">
                <div class="col-12">
                    <div class="accordion accordion-flush" id="patientPersonasAccordion">
                        {% for persona in personas %}
                            {% set collapse_id = 'collapsePersona' ~ loop.index %}
                            {% set heading_id = 'headingPersona' ~ loop.index %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="{{ heading_id }}">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#{{ collapse_id }}" aria-expanded="false" aria-controls="{{ collapse_id }}">
                                        {{ persona.name or 'Unknown Patient' }} â€” {{ persona.subtype_name or 'Subtype Unspecified' }}
                                    </button>
                                </h2>
                                <div id="{{ collapse_id }}" class="accordion-collapse collapse" aria-labelledby="{{ heading_id }}" data-bs-parent="#patientPersonasAccordion">
                                    <div class="accordion-body">
                                        <div class="mb-3">
                                            <p class="text-muted fw-semibold small text-uppercase mb-1">State of Change</p>
                                            <p class="mb-0">{{ persona.state_of_change or 'Not specified' }}</p>
                                        </div>

                                        <div class="mb-3">
                                            <p class="text-muted fw-semibold small text-uppercase mb-1">Persona Summary</p>
                                            <p class="mb-0">{{ persona.persona_description or 'No summary available.' }}</p>
                                        </div>

                                        <hr class="my-4">

                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Subtype Description</p>
                                                <p>{{ persona.ad_subtype_description or 'Not specified' }}</p>

                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Age & AUD Overview</p>
                                                <p>{{ persona.age_onset or 'Not specified' }}<br>{{ persona.aud_severity_symptoms or '' }}</p>

                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Drinking Pattern</p>
                                                <p>{{ persona.drinking_pattern or 'Not specified' }}</p>

                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Help-Seeking Behavior</p>
                                                <p>{{ persona.help_seeking_behavior or 'Not specified' }}</p>
                                            </div>
                                            <div class="col-md-6">
                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Family History</p>
                                                <p>{{ persona.family_history_of_alcohol_dependence or 'Not specified' }}</p>

                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Antisocial Personality Disorder</p>
                                                <p>{{ persona.antisocial_personality_disorder or 'Not specified' }}</p>

                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Comorbid Psychiatric Disorders</p>
                                                <p>{{ persona.comorbid_psychiatric_disorders or 'Not specified' }}</p>

                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Comorbid Substance Use</p>
                                                <p>{{ persona.comorbid_substance_use or 'Not specified' }}</p>

                                                <p class="text-muted fw-semibold small text-uppercase mb-1">Psychosocial Indicators</p>
                                                <p class="mb-0">{{ persona.psychosocial_indicators or 'Not specified' }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        {% else %}
            <div class="row">
                <div class="col-12">
                    <div class="alert alert-warning" role="alert">
                        Patient persona details are not available at the moment.
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    <footer class="site-footer">
        <div class="container text-center">
            <p>&copy; 2025 Northeastern University | Ian Steenstra | <a href="https://relationalagents.com/" target="_blank" rel="noopener noreferrer">Relational Agents Group</a></p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
